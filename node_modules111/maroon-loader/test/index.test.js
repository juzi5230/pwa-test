"use strict";

require("should");
const path = require("path");
const webpack = require("webpack");
const pathToLessLoader = path.resolve(__dirname, "../lib/loader.js");

describe("maroon-loader", () => {
  test("开始测试maroon-loader", "basic");
});

function resolve (dir) {
  return path.join(__dirname, '..', dir)
}

function test(name) {
  it(name, (done) => {
    const vueFile = path.resolve(__dirname, "./raw/test.vue");
    const config = {
        resolve: {
            modules: [
                "node_modules"
            ],
            alias: {
              'maroon': resolve('packages')
            }
        }
    };
    webpack({
        entry: vueFile,
        context: __dirname,
        resolve: config.resolve,
        output: {
            path: path.resolve(__dirname, "output"),
            filename: "bundle.vue",
            libraryTarget: "var"
        },
        module: {
            rules: [
                {
                    test: /\.vue$/,
                    use: [
                        'raw-loader',
                        {
                            loader: pathToLessLoader,
                            options: {
                              name: 'maroon',
                              path: 'maroon' // 这个和上面的resolve.alias相同
                            }
                        }
                    ]
                }
            ]
        }
    }, (err, stats) => {
      console.log('test')
      console.log(err)
      done();
    })
  })
}
